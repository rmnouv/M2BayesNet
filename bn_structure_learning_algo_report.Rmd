---
title: "Bayesian Network Structure Learning Algorithm Report"
author: "HONG Kimmeng, KOH Tito, NOUV Ratanak Muny"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load package
```{r}
library(M2BayesNet)
```


Create multinomial data
```{r}
library(datasets)
data("Titanic")
Titanic_df <- as.data.frame(Titanic)
Titanic_df <- Titanic_df[rep(seq_len(nrow(Titanic_df)), Titanic_df$Freq), 1:4]
```

Create gaussian data
```{r}
data(iris)
iris$Species <- as.numeric(iris$Species)
iris_matrix <- as.matrix(iris)
```

```{r}
# for Gaussian dataset
dataset <- iris_matrix
distribution <- "gaussian"

res <- branch_and_bound_bn_cpp(dataset, distribution = distribution)
set_adj_names(res$best_adj, dataset)
res$best_score
```

```{r}
# for Multinomial dataset
dataset <- Titanic_df
distribution <- "multinomial"

res <- branch_and_bound_bn_cpp(dataset, distribution = distribution)
set_adj_names(res$best_adj, dataset)
res$best_score
res
```


```{r}
library(ggplot2)

# helper: run single trial for a given data matrix X and distribution
run_trial <- function(X, distribution = "multinomial", impl = c("R","Rcpp")) {
  impl <- match.arg(impl)
  p <- ncol(X)

  # Precompute scores in R (shared for both implementations)
  scores <- precompute_local_scores(X, distribution)

  if (impl == "R") {
    # ensure R version uses the same precomputed scores_list if you modified it to accept it,
    # otherwise the pure R implementation will recompute scores: keep consistent.
    t0 <- Sys.time()
    res <- branch_and_bound_bn(X, distribution)   # returns list with time and nodes_explored
    t1 <- Sys.time()
    elapsed <- as.numeric(difftime(t1, t0, units = "secs"))
    # prefer res$time if your R function already records time using Sys.time inside
    elapsed <- as.numeric(res$time) # use internal measured time if present
    nodes_explored <- if (!is.null(res$nodes_explored)) res$nodes_explored else NA
    pruned <- if (!is.null(res$pruned)) res$pruned else NA
    best_score <- res$best_score
  } else {
    # Rcpp version: pass p and scores
    t0 <- Sys.time()
    res_cpp <- branch_and_bound_bn_cpp(ncol(X), as.matrix(X), scores)
    t1 <- Sys.time()
    elapsed <- as.numeric(difftime(t1, t0, units = "secs"))
    # prefer res_cpp$time (it returns elapsed measured in C++)
    elapsed <- as.numeric(res_cpp$time)
    nodes_explored <- as.integer(res_cpp$nodes_explored)
    pruned <- as.integer(res_cpp$pruned)
    best_score <- as.numeric(res_cpp$best_score)
  }

  data.frame(
    impl = impl,
    p = p,
    elapsed = elapsed,
    nodes_explored = nodes_explored,
    pruned = pruned,
    best_score = best_score,
    stringsAsFactors = FALSE
  )
}
```
```{r}

```






